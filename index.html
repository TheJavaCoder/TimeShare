<html>

	<head>
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	
		<style>
	
			body, html {
				padding: 0px; margin: 0px;
				overflow:hidden;
			}
			
			#container {
				width: 100%;
				height: 100%;
				background-color: #3D3D3D;
				color: white;
				font-family: 'Roboto', sans-serif;
			}
			
			
			
		</style>
		
		
		
	</head>
	
	<body>
	
	
		<div id="container">
			<div id="toolbar">
				
			</div>
			
			<div id="content">
			
				<div id="username"></div>
				<canvas id="myCanvas" style="margin-left: auto; margin-right: auto;"></canvas>
				
				
				
			</div>
	
		</div>
	
	</body>
	
	
	<script>

	
			getFormattedTime = function (fourDigitTime) {
				var hours24 = parseInt(fourDigitTime.toString().split('.')[0]);
				var min = fourDigitTime.toString().split('.')[1];
				
				
				
				if(min == null) {
					min = '00';
				}else {
					min = Math.floor(min * 60 / 1e1);
				}
				
				
				
				
				var amPm = 'pm';
				if(hours24 - 11 < 0 || hours24 > 23) {
					amPm = 'am';
				}
				
				
				var hours = ((hours24 + 11) % 12) + 1;
				
				
			
				return hours + ':' + min + " " + amPm;
			};
	
			function drawPieSlice(ctx,centerX, centerY, radius, startAngle, endAngle, color ){
				ctx.fillStyle = color;
				ctx.beginPath();
				ctx.moveTo(centerX,centerY);
				ctx.arc(centerX, centerY, radius, startAngle, endAngle);
				ctx.closePath();
				ctx.fill();
			}
			
			
			
			function clickPieSlice(ctx,centerX, centerY, radius, startAngle, endAngle){
				
				ctx.beginPath();
				ctx.moveTo(centerX,centerY);
				ctx.arc(centerX, centerY, radius, startAngle, endAngle);
				
			}
			
			function drawCurrentAppointmentText(ctx, x, y, current) {
				
				if(current != null && current.title != null) {
					return;
				}
				
				ctx.font = "15px Arial";
				ctx.fillStyle = "grey";
				ctx.fillText("Current Appointment", x, y - 38);
				ctx.fillText("Planned Time ", x, y + 38);
				
				ctx.font = "25px Arial";
				ctx.fillStyle = "white";
				ctx.fillText(current.AppointTitle, x, y);
				
				ctx.fillText(getFormattedTime(current.startTime) + " to " + getFormattedTime(current.endTime), x, y + 75);
				
				
			}
			
			
			function drawTimeMarkers(ctx, x, y, radius) {
			
				
			
				ctx.font = "15px Arial";
				ctx.fillStyle = "grey";
				
			
				
				ctx.fillText("Noon", x - 10, y + radius - 30);
				ctx.fillText("Midnight", x - 40, y - radius + 30);
				ctx.fillText("6 AM", x + radius - 80, y + 10);
				ctx.fillText("6 PM", x - radius + 20, y + 10);
				
			}
			
			
			
			var Piechart = function(options){
				this.options = options;
				this.scale = options.scale;
				this.canvas = options.canvas;
				this.ctx = this.canvas.getContext("2d");
				this.hitctx = options.hitctx;
				this.colors = options.colors;
				this.x = options.centerPointX;
				this.y = options.centerPointY;
				this.currentTimeAngle = 0;
				this.currentAppointment = {};
				this.highlightedTimeBlock = options.highlightedTimeBlock;
				
			
				
			
				this.draw = function(){
					
					
					this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
					var total_value = 0;
					var color_index = 0;
					var currentTimeAngle;
					var d = new Date();
					var n = d.getHours();
					
					for (var categ in this.options.data){
						var val = this.options.data[categ];
						total_value += val.endTime - val.startTime;
						
						
						
					}
			
					var start_angle = 29.75;
					for (categ in this.options.data){
						val = this.options.data[categ];
						var slice_angle = 2 * Math.PI * (val.endTime - val.startTime) / 24;
						
						var newScale = options.scale;
						
						if(this.highlightedTimeBlock != null) {
							console.log(val);
							if(this.highlightedTimeBlock === val.id) {
								newScale = 2.8;
							}
						}
						
						drawPieSlice(
							this.ctx,
							this.x,
							this.y,
							Math.min(this.canvas.width/newScale,this.canvas.height/newScale),
							start_angle,
							start_angle+slice_angle,
							val.color
						);
						
						drawPieSlice(
							this.hitctx,
							this.x,
							this.y,
							Math.min(this.canvas.width/newScale,this.canvas.height/newScale),
							start_angle,
							start_angle+slice_angle,
							val.colorKey
						);
						
						
						
						
						console.log(d.getMinutes() / 100);
						
						
						if(val.startTime <= n + (d.getMinutes() / 60)   && n + (d.getMinutes() / 60) <= val.endTime) {
							
							var slice = 2 * Math.PI * ((n - val.startTime) / 24 );
							
							this.currentTimeAngle = start_angle + slice + (d.getMinutes() / 360) ;
							this.currentAppointment = val;
							console.log(currentTimeAngle);
							console.log(d.getMinutes());
							
						}
						
						
						
			
						start_angle += slice_angle;
						color_index++;
					}
			
					//drawing a white circle over the chart
					//to create the doughnut chart
					if (this.options.doughnutHoleSize){
						drawPieSlice(
							this.ctx,
							this.x,
							this.y,
							this.options.doughnutHoleSize * Math.min(this.canvas.width/options.scale,this.canvas.height/options.scale),
							0,
							2 * Math.PI,
							"#3D3D3D"
						);
					}
					
					
					start_angle = 29.75;
					for (categ in this.options.data){
						
						val = this.options.data[categ];
						
						var slice_angle = 2 * Math.PI * (val.endTime - val.startTime) / 24;
						var pieRadius = Math.min(this.canvas.width/2,this.canvas.height/2);
						var labelX = this.canvas.width/2 + (pieRadius / 2) * Math.cos(start_angle + slice_angle/2);
						var labelY = this.canvas.height/2 + (pieRadius / 2) * Math.sin(start_angle + slice_angle/2);
					
						if (this.options.doughnutHoleSize){
							var offset = (pieRadius * this.options.doughnutHoleSize * 1.2) / 3;
							labelX = this.canvas.width/2 + (offset + pieRadius / 2) * Math.cos(start_angle + slice_angle/2) - offset / 16 - 10;
							labelY = this.canvas.height/2 + (offset + pieRadius / 2) * Math.sin(start_angle + slice_angle/2) - offset / 16;               
						}
					
						
					
						var labelText = Math.round(100 * val / total_value);
						this.ctx.fillStyle = "white";
						this.ctx.font = "bold 12px Arial";
						
						if(this.highlightedTimeBlock != null) {
							console.log(val);
							if(this.highlightedTimeBlock === val.id) {
								this.ctx.fillText(val.AppointTitle, labelX,labelY);
								this.ctx.fillText(getFormattedTime(val.startTime) + " - " + getFormattedTime(val.endTime), labelX,labelY+ 15);
								
							}
						}
						
						start_angle += slice_angle;
					}
					
					
					drawPieSlice(
								this.ctx,
								this.x,
								this.y,
								this.options.doughnutHoleSize * Math.min(this.canvas.width/options.scale,this.canvas.height/options.scale),
								this.currentTimeAngle   ,
								this.currentTimeAngle  + 0.008,
								"white"
							);
					
					drawCurrentAppointmentText(this.ctx, this.canvas.width * .75, this.canvas.height * 0.70, this.currentAppointment);
					drawTimeMarkers(this.ctx, this.x, this.y, Math.min(this.canvas.width/options.scale,this.canvas.height/options.scale));
			
				}
			}
			
			
			
			function getRandomColor() {
				const r = Math.round(Math.random() * 255);
				const g = Math.round(Math.random() * 255);
				const b = Math.round(Math.random() * 255);
				return `rgb(${r},${g},${b})`;
			}
			
			
		
			var myCanvas = document.getElementById("myCanvas");
			myCanvas.width = window.innerWidth ;
			myCanvas.height = window.innerHeight ;
			
			var hitCanvas = document.createElement("canvas");
			hitCanvas.width = window.innerWidth ;
			hitCanvas.height = window.innerHeight ;
			
			
			
			var scale = 0.2;
			var doughnutHoleSize = 2;
			
			var ctx = myCanvas.getContext("2d");
			var hitctx = hitCanvas.getContext("2d");
		
			var colorsHash = {};
		
			var myVinyls = {
				"Free Time1": {"startTime": 0,  "endTime": 8, "AppointTitle": "~ None ~", "id":0, "color": "#3D3D3D"},
				"Jim": {"startTime": 8,  "endTime": 9, "AppointTitle": "Meet with Jim", "id":1, "color": "#E84A5F"},
				"Jimmy": {"startTime": 9,  "endTime": 10.5, "AppointTitle": "Billy ", "id":2, "color": "#FF847C"},
				"Mary": {"startTime": 10.5,  "endTime": 12, "AppointTitle": "Meet with Mary", "id":3, "color": "#E84A5F"},
				"Lunch": {"startTime": 12,  "endTime": 12.5, "AppointTitle": "Lunch", "id":4, "color": "#FECEA8"},
				"Time Slot 1": {"startTime": 12.5,  "endTime": 20, "AppointTitle": "Available", "id":5, "color": "#99B898"},
				"John": {"startTime": 20,  "endTime": 23.99, "AppointTitle": "~ None ~", "id":6, "color": "#3D3D3D"},
				
			};
			
			for (categ in myVinyls) {
				val = myVinyls[categ];
				var done = false;
				while(!done) {
					const colorKey = getRandomColor();
					if(!colorsHash[colorKey]) {
						val.colorKey = colorKey;
						colorsHash[colorKey] = val;
						done = true;
					}
				}
			}
			console.log(myVinyls);
			
			
			var myDougnutChart = new Piechart(
				{
					canvas:myCanvas,
					data:myVinyls,
					colors:["#3D3D3D", "#FE4365", "#3D3D3D","#FC9D9A", "#F9CDAD","#C8C8A9","83AF9B", "blue"],
					doughnutHoleSize:.95,
					scale: 3,
					centerPointX: myCanvas.width/2,
					centerPointY: myCanvas.height/2,
					highlightedTimeBlock:0,
					hitctx: hitctx
				}
			);
			myDougnutChart.draw();
			
			
			function drawClock() {
				myDougnutChart.draw();
			}
			
			setInterval(drawClock, 30000);
			
			myCanvas.addEventListener('click', (e) => {
				const mousePos = {
					x: e.clientX - myCanvas.offsetTop,
					y: e.clientY - myCanvas.offsetLeft
				};
				const pixel = hitctx.getImageData(mousePos.x, mousePos.y, 1, 1).data;
				const color = `rgb(${pixel[0]},${pixel[1]},${pixel[2]})`;
				const shape = colorsHash[color];
				if (shape) {
					myDougnutChart = new Piechart(
						{
							canvas:myCanvas,
							data:myVinyls,
							colors:["#3D3D3D", "#FE4365", "#3D3D3D","#FC9D9A", "#F9CDAD","#C8C8A9","83AF9B", "blue"],
							doughnutHoleSize:.95,
							scale: 3,
							centerPointX: myCanvas.width/2,
							centerPointY: myCanvas.height/2,
							highlightedTimeBlock:shape.id,
							hitctx: hitctx
						}
					);
					
					myDougnutChart.draw();
					
				}else {
					myDougnutChart = new Piechart(
						{
							canvas:myCanvas,
							data:myVinyls,
							colors:["#3D3D3D", "#FE4365", "#3D3D3D","#FC9D9A", "#F9CDAD","#C8C8A9","83AF9B", "blue"],
							doughnutHoleSize:.95,
							scale: 3,
							centerPointX: myCanvas.width/2,
							centerPointY: myCanvas.height/2,
							highlightedTimeBlock:null,
							hitctx: hitctx
						}
					);
					
					myDougnutChart.draw();
				}
			});
			
			
			
			
			
			
			
			
		</script>


</html>